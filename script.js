let rowsOfButtons = [
    {
    "Backquote": "`",
    "Digit1": "1",
    "Digit2": "2",
    "Digit3": "3",
    "Digit4": "4",
    "Digit5": "5",
    "Digit6": "6",
    "Digit7": "7",
    "Digit8": "8",
    "Digit9": "9",
    "Digit0": "0",
    "Minus": "-",
    "Equal": "=",
    "Backspace": "Backspace"
    },
    {
    "Tab": "Tab",
    "KeyQ": "q",
    "KeyW": "w",
    "KeyE": "e",
    "KeyR": "r",
    "KeyT": "t",
    "KeyY": "y",
    "KeyU": "u",
    "KeyI": "i",
    "KeyO": "o",
    "KeyP": "p",
    "BracketLeft": "[",
    "BracketRight": "]",
    "Backslash": "\\",
    "Delete": "Del"
    },
    {
    "CapsLock": "CapsLock",
    "KeyA": "a",
    "KeyS": "s",
    "KeyD": "d",
    "KeyF": "f",
    "KeyG": "g",
    "KeyH": "h",
    "KeyJ": "j",
    "KeyK": "k",
    "KeyL": "l",
    "Semicolon": ";",
    "Quote": "'",
    "Enter": "Enter"
    },
    {
    "ShiftLeft": "Shift",
    "KeyZ": "z",
    "KeyX": "x",
    "KeyC": "c",
    "KeyV": "v",
    "KeyB": "b",
    "KeyN": "n",
    "KeyM": "m",
    "Comma": ",",
    "Period": ".",
    "Slash": "/",
    "ArrowUp": "▲",
    "ShiftRight": "Shift"
    },
    {
    "ControlLeft": "Ctrl",
    "MetaLeft": "Win",
    "AltLeft": "Alt",
    "Space": " ",
    "AltRight": "Alt",
    "ArrowLeft": "◄",
    "ArrowDown": "▼",
    "ArrowRight": "►",
    "ControlRight": "Ctrl"
    }
]

let rowsOfButtonsEng = {
    "Backquote": "`",
    "Digit1": "1",
    "Digit2": "2",
    "Digit3": "3",
    "Digit4": "4",
    "Digit5": "5",
    "Digit6": "6",
    "Digit7": "7",
    "Digit8": "8",
    "Digit9": "9",
    "Digit0": "0",
    "Minus": "-",
    "Equal": "=",
    "Backspace": "Backspace",
    "Tab": "Tab",
    "KeyQ": "q",
    "KeyW": "w",
    "KeyE": "e",
    "KeyR": "r",
    "KeyT": "t",
    "KeyY": "y",
    "KeyU": "u",
    "KeyI": "i",
    "KeyO": "o",
    "KeyP": "p",
    "BracketLeft": "[",
    "BracketRight": "]",
    "Backslash": "\\",
    "Delete": "Del",
    "CapsLock": "CapsLock",
    "KeyA": "a",
    "KeyS": "s",
    "KeyD": "d",
    "KeyF": "f",
    "KeyG": "g",
    "KeyH": "h",
    "KeyJ": "j",
    "KeyK": "k",
    "KeyL": "l",
    "Semicolon": ";",
    "Quote": "'",
    "Enter": "Enter",
    "ShiftLeft": "Shift",
    "KeyZ": "z",
    "KeyX": "x",
    "KeyC": "c",
    "KeyV": "v",
    "KeyB": "b",
    "KeyN": "n",
    "KeyM": "m",
    "Comma": ",",
    "Period": ".",
    "Slash": "/",
    "ArrowUp": "▲",
    "ShiftRight": "Shift",
    "ControlLeft": "Ctrl",
    "MetaLeft": "Win",
    "AltLeft": "Alt",
    "Space": " ",
    "AltRight": "Alt",
    "ArrowLeft": "◄",
    "ArrowDown": "▼",
    "ArrowRight": "►",
    "ControlRight": "Ctrl"
    }

let rowsOfButtonsRus = {
    "Backquote": "ё",
    "Digit1": "1",
    "Digit2": "2",
    "Digit3": "3",
    "Digit4": "4",
    "Digit5": "5",
    "Digit6": "6",
    "Digit7": "7",
    "Digit8": "8",
    "Digit9": "9",
    "Digit0": "0",
    "Minus": "-",
    "Equal": "=",
    "Backspace": "Backspace",
    "Tab": "Tab",
    "KeyQ": "й",
    "KeyW": "ц",
    "KeyE": "у",
    "KeyR": "к",
    "KeyT": "е",
    "KeyY": "н",
    "KeyU": "г",
    "KeyI": "ш",
    "KeyO": "щ",
    "KeyP": "з",
    "BracketLeft": "х",
    "BracketRight": "ъ",
    "Backslash": "\\",
    "Delete": "Del",
    "CapsLock": "CapsLock",
    "KeyA": "ф",
    "KeyS": "ы",
    "KeyD": "в",
    "KeyF": "а",
    "KeyG": "п",
    "KeyH": "р",
    "KeyJ": "о",
    "KeyK": "л",
    "KeyL": "д",
    "Semicolon": "ж",
    "Quote": "э",
    "Enter": "Enter",
    "ShiftLeft": "Shift",
    "KeyZ": "я",
    "KeyX": "ч",
    "KeyC": "с",
    "KeyV": "м",
    "KeyB": "и",
    "KeyN": "т",
    "KeyM": "ь",
    "Comma": "б",
    "Period": "ю",
    "Slash": ".",
    "ArrowUp": "▲",
    "ShiftRight": "Shift",
    "ControlLeft": "Ctrl",
    "MetaLeft": "Win",
    "AltLeft": "Alt",
    "Space": " ",
    "AltRight": "Alt",
    "ArrowLeft": "◄",
    "ArrowDown": "▼",
    "ArrowRight": "►",
    "ControlRight": "Ctrl"
    }

let shiftButtonsRus = {
    "ShiftLeft": "Shift",
    "Backquote": "Ё",
    "Digit1": "!",
    "Digit2": "\"",
    "Digit3": "№",
    "Digit4": ";",
    "Digit5": "%",
    "Digit6": ":",
    "Digit7": "?",
    "Digit8": "*",
    "Digit9": "(",
    "Digit0": ")",
    "Minus": "_",
    "Equal": "+",
    "KeyQ": "Й",
    "KeyW": "Ц",
    "KeyE": "У",
    "KeyR": "К",
    "KeyT": "Е",
    "KeyY": "Н",
    "KeyU": "Г",
    "KeyI": "Ш",
    "KeyO": "Щ",
    "KeyP": "З",
    "BracketLeft": "Х",
    "BracketRight": "Ъ",
    "Backslash": "/",
    "KeyA": "Ф",
    "KeyS": "Ы",
    "KeyD": "В",
    "KeyF": "А",
    "KeyG": "П",
    "KeyH": "Р",
    "KeyJ": "О",
    "KeyK": "Л",
    "KeyL": "Д",
    "Semicolon": "Ж",
    "Quote": "Э",
    "KeyZ": "Я",
    "KeyX": "Ч",
    "KeyC": "С",
    "KeyV": "М",
    "KeyB": "И",
    "KeyN": "Т",
    "KeyM": "Ь",
    "Comma": "Б",
    "Period": "Ю",
    "Slash": ","
}

let shiftButtonsEng = {
    "Backquote": "~",
    "Digit1": "!",
    "Digit2": "@",
    "Digit3": "#",
    "Digit4": "$",
    "Digit5": "%",
    "Digit6": "^",
    "Digit7": "&",
    "Digit8": "*",
    "Digit9": "(",
    "Digit0": ")",
    "Minus": "_",
    "Equal": "+",
    "KeyQ": "Q",
    "KeyW": "W",
    "KeyE": "E",
    "KeyR": "R",
    "KeyT": "T",
    "KeyY": "Y",
    "KeyU": "U",
    "KeyI": "I",
    "KeyO": "O",
    "KeyP": "P",
    "BracketLeft": "{",
    "BracketRight": "}",
    "Backslash": "|",
    "KeyA": "A",
    "KeyS": "S",
    "KeyD": "D",
    "KeyF": "F",
    "KeyG": "G",
    "KeyH": "H",
    "KeyJ": "J",
    "KeyK": "K",
    "KeyL": "L",
    "Semicolon": ":",
    "Quote": "\"",
    "KeyZ": "Z",
    "KeyX": "X",
    "KeyC": "C",
    "KeyV": "V",
    "KeyB": "B",
    "KeyN": "N",
    "KeyM": "M",
    "Comma": "<",
    "Period": ">",
    "Slash": "?"
}

let checker = `eng`;


let body = document.querySelector(`body`);

let title = document.createElement(`p`);
title.classList.add(`title`);
title.innerHTML = `RSS Виртуальная клавиатура`;
body.append(title);

let innerField = document.createElement(`textarea`);
innerField.classList.add(`textarea`)
body.append(innerField)

let keyBoard = document.createElement(`div`);
keyBoard.classList.add('keyBoard');
body.append(keyBoard)

let info = document.createElement(`p`);
info.classList.add(`info`);
info.innerHTML = `Клавиатура создана в операционной системе Windows`;
body.append(info);

let lang = document.createElement(`p`);
lang.classList.add(`lang`);
lang.innerHTML = `Для переключения языка комбинация: левыe shiftLeft + alt`;
body.append(lang);



for (let element of rowsOfButtons) {
    let buttonRow = document.createElement(`div`);
    buttonRow.classList.add(`buttonRow`);
    keyBoard.append(buttonRow)
    for (let el in element) {
        let button = document.createElement(`div`);
        button.classList.add(`button`);
        button.classList.add(el);
        button.innerHTML = element[el];
        buttonRow.append(button);
    }
}

// document.addEventListener(`keydown`, function (e) {
//     shiftButtonsRus[e.code] = e.key;
//     console.log(e.code, e.key)
//     console.log(shiftButtonsRus)
// })

let turner = [];

document.addEventListener(`keydown`, function colorChangerOn (e){
    // Анимация кнопок при нажатии (можно улучшить!)

    for (let element of keyBoard.children) {
        for (let el of element.children) {
            if ([...el.classList].includes(e.code)) {
                el.style.transform = `scale(0.9)`;
                el.style.boxShadow = `0px 10px 20px 2px rgba(0, 0, 0, 0.25)`;
                el.style.backgroundColor = `#45ff01`;
            }
        }
    }

    // Настройка таба

    if (e.code === 'Tab') {
        e.preventDefault();
        innerField.innerHTML += `   `;
    }

    // Меняет раскладку
    
    if ((e.code === 'ControlLeft' || e.code === 'AltLeft') && turner.length < 2) {
        turner.push (e.code)
    } else if (turner.length >= 2) {
        turner.splice(0, 1);
    }
    if (turner[0] === 'ControlLeft' && turner[1] === 'AltLeft')  {
        if (checker === `rus`) {
            for (let element of keyBoard.children) {
                for (let i = 0; i < element.children.length; i++) { 
                    element.children[i].innerHTML = rowsOfButtonsEng[element.children[i].classList[1]];
                }
            }
            checker = `eng`;
        } else if (checker === `eng`) {
            for (let element of keyBoard.children) {
                for (let i = 0; i < element.children.length; i++) { 
                    element.children[i].innerHTML = rowsOfButtonsRus[element.children[i].classList[1]];
                }
            }
            checker = `rus`;
        }
        turner = [];
    }
    
    // Меняет регистр

    if (e.code === 'CapsLock') {
        for (let element of keyBoard.children) {
            for (let el of element.children) {
                if (el.innerHTML.length <= 1 && el.innerHTML[0] != el.innerHTML[0].toUpperCase()) {
                    el.innerHTML = el.innerHTML.toUpperCase();
                } else if (el.innerHTML.length <= 1 && el.innerHTML[0] == el.innerHTML[0].toUpperCase()){
                    el.innerHTML = el.innerHTML.toLowerCase();
                }
            }
        }
    }

    // Нормальный рабочий обработчик шифтов на изменение символов!!!!!!!

    if (e.code === 'ShiftLeft' || e.code === `ShiftRight`) {
        if (checker == `rus`) {
            for (let element of keyBoard.children) {
                for (let i = 0; i < element.children.length; i++) { 
                    if (element.children[i].innerHTML != shiftButtonsRus[element.children[i].classList[1]] && Object.keys(shiftButtonsRus).includes(element.children[i].classList[1])) {
                        element.children[i].innerHTML = shiftButtonsRus[element.children[i].classList[1]];
                    }
                }
            }
        } else if (checker == `eng`) {
            for (let element of keyBoard.children) {
                for (let i = 0; i < element.children.length; i++) { 
                    if (element.children[i].innerHTML != shiftButtonsEng[element.children[i].classList[1]] && Object.keys(shiftButtonsEng).includes(element.children[i].classList[1])) {
                        element.children[i].innerHTML = shiftButtonsEng[element.children[i].classList[1]];
                    }
                }
            }
        }
    }
    
})

document.addEventListener(`keyup`, function colorChangerOff (e){
    // Стили клавиш при поднятии клавиши

    for (let element of keyBoard.children) {
        for (let el of element.children) {
            if ([...el.classList].includes(e.code)) {
                el.style.transform = `scale(1)`;
                el.style.boxShadow = `2px 2px 2px 0px rgba(0,0,0,0.3)`;
                el.style.backgroundColor = `#0000005e`;
                if (el.innerHTML.length <= 1) {
                    innerField.innerHTML += el.innerHTML
                }
            }
            
        }
    }

    // Возвращает буквы в норму, когда отпускается левый или правый шифты

    if (e.code === 'ShiftLeft' || e.code === `ShiftRight`) {
        if (checker == `rus`) {
            for (let element of keyBoard.children) {
                for (let i = 0; i < element.children.length; i++) { 
                    element.children[i].innerHTML = rowsOfButtonsRus[element.children[i].classList[1]];
                }
            }
        } else if (checker == `eng`) {
            for (let element of keyBoard.children) {
                for (let i = 0; i < element.children.length; i++) { 
                    element.children[i].innerHTML = rowsOfButtonsEng[element.children[i].classList[1]];
                }
            }
        }
    }
})






//======================================================= Действия Мыши


document.addEventListener(`mousedown`, function func (e) {
    
    if ([...e.target.classList].includes(`button`)) {
        e.target.style.transform = `scale(0.9)`;
        e.target.style.boxShadow = `0px 10px 20px 2px rgba(0, 0, 0, 0.25)`;
    }

    if ([...e.target.classList].includes(`button`) && e.target.innerHTML.length <= 1) {
        innerField.innerHTML += e.target.innerHTML;
    }
    
    if ([...e.target.classList].includes(`Enter`)) {
        innerField.innerHTML += `\n`;
    };

    if ([...e.target.classList].includes(`Tab`)) {
        innerField.innerHTML += `   `;
    }

    if ([...e.target.classList].includes(`CapsLock`)) {
            for (let element of keyBoard.children) {
                for (let el of element.children) {
                    if (el.innerHTML.length <= 1 && el.innerHTML[0] != el.innerHTML[0].toUpperCase()) {
                        el.innerHTML = el.innerHTML.toUpperCase();
                    } else if (el.innerHTML.length <= 1 && el.innerHTML[0] == el.innerHTML[0].toUpperCase()){
                        el.innerHTML = el.innerHTML.toLowerCase();
                    }
                }
            }
    }

    if ([...e.target.classList].includes(`Backspace`)) {
        console.log(innerField.innerHTML.split(``));
        let arr = innerField.innerHTML.split(``);
        arr.splice(innerField.selectionStart - 1, 1);
        innerField.innerHTML = arr.join('');
    }

    if ([...e.target.classList].includes(`Delete`) && innerField.selectionStart > 0) {
        console.log(innerField.innerHTML.split(``));
        let arr = innerField.innerHTML.split(``);
        arr.splice(innerField.selectionStart, 1);
        innerField.innerHTML = arr.join('');
    }
    
});

innerField.addEventListener(`focus`, function () {
    
})

document.addEventListener(`mouseup`, function func (e) {
    if ([...e.target.classList].includes(`button`)) {
        e.target.style.transform = `scale(1)`;
        e.target.style.boxShadow = `2px 2px 2px 0px rgba(0,0,0,0.3)`;
    }
});

